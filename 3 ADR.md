# Architectural Decision Records

## ADR #1. Архитектурный стиль системы "AutoPart Express"

### Контекст и постановка задачи
Выбор архитектурного стиля для системы "AutoPart Express".

### Драйверы принятия решений
- Ожидаем роста числа клиентов и заказов. Необходима высокая масштабируемость.
- Адаптивность и независимость компонентов. Различные части системы должны разрабатываться и масштабироваться независимо друг от друга.
- Надежность. Выход из строя одной части системы не должен влиять на работу остальных частей.

### Рассматриваемые варианты (альтернативы)
- Монолитная архитектура
- Микросервисная архитектура
- Гибридная архитектура

Существующие решения на рынке не рассматривались по причине того, что компания "Авто-Гарантия" стремится сократить зависимость от сторонних решений и активно вкладывает деньги в развитие своих собственных решений.
  
### Результат решения
Выбран вариант: "Микросервисная архитектура", так как она позволяет нам достичь высокой масштабируемости и обеспечить независимость компонентов системы. 

• Положительные последствия: 
- гибкость, масштабируемость, надежность.

• Негативные последствия:
- Увеличенная сложность разработки
- Сложность развертывания и управления, большие затраты на инфраструктуру.


### Сравнительный анализ
#### Монолитная архитектура
- Плюсы
  - Быстрая разработка
- Минусы
  - Ограниченная масштабируемость по сравнению с микросервисной архитектурой.
  - Потенциальная сложность обслуживания по мере роста системы. 

#### Микросервисная архитектура
- Плюсы
  - Масштабируемость и гибкость за счет независимых сервисов.
  - Невысокая стоимость обслуживания и модернизации по мере роста системы.
  
- Минусы
  - Низкая скорость разработки 
  - Повышенная сложность в оркестровке служб, обмене данными и согласованности данных.
  - Операционные накладные расходы на управление несколькими службами и инфраструктурой.

#### Гибридная архитектура
- Плюсы
  - Быстрая разработка.
  - Гибкость и масштабируемость в долгосрочной перспективе.
  
- Минусы
  - Архитектурная сложность, связанная с сочетанием монолитной и микросервисной архитектур.
  - Затраты на переход от монолитной системы к микросервисной архитектуре.


## ADR #2: Выбор модели взаимодействия между сервисами

### Контекст и постановка задачи
Выбор подхода к модели взаимодействия между сервисами: синхронное или асинхронное взаимодействие.

### Драйверы принятия решений
- Необходимость обеспечения масштабируемости. Система ориентирована на рост и требует гибкости в масштабировании компонентов.
- Улучшение отказоустойчивости. 

### Рассматриваемые варианты
- Синхронное взаимодействие - REST запросы.
- Асинхронное взаимодействие с использованием message queue.

### Результат решения
Выбран вариант: "Асинхронное взаимодействие" (Event Sourcing). Этот выбор обусловлен необходимостью обеспечения масштабируемости и отказоустойчивости системы "AutoPart Express". Отказоустойчивость обеспечивается независимостью работы каждого сервиса, достигается Graceful Degradation (сбой компонента не приводит к отказу всей системы)


• Положительные последствия: 
- Высокая масштабируемость
- Улучшенная отказоустойчивость
- Возможность работы сервисов независимо друг от друга.

• Негативные последствия:
- Увеличенная сложность разработки
- Дополнительная сложность поддержки.
- Вероятность появление неконсистентных данных на некоторый перид времени.

### Сравнительный анализ

### Асинхронное взаимодействие

- Плюсы 
  - Высокая масштабируемость
  - Улучшенная отказоустойчивость
  - Возможность работы сервисов независимо друг от друга.
- Минусы
  - Сложность разработки
  - Сложность поддержки.

### Синхронное взаимодействие:

- Плюсы
  - Простота в реализации и отладке.

- Минусы
  - Ограниченная масштабируемость
  - Большая вероятность блокировок и зависаний при высокой нагрузке
  - Низкая отказоустойчивость.


## ADR #3: Размещение корзины в отдельном сервисе

### Контекст и постановка задачи
В каком сервисе следует разместить функционал корзины в системе. Рассматривается вариант выделения корзины в отдельный сервис.

### Драйверы принятия решений
- Масштабируемость. 
- Независимость и гибкость.

### Рассматриваемые варианты
- Размещение функционала корзины внутри сервиса Заказов.
- Выделение корзины в отдельный микросервис.

### Результат решения:
Выбран вариант: "Выделение корзины в отдельный микросервис". Этот выбор обоснован стремлением к улучшению масштабируемости и обеспечению независимости компонентов системы. Отдельный сервис для корзины упростит ее управление, расширение функционала и обеспечит возможность работы с корзиной независимо от процесса заказа.

• Положительные последствия: 
- Улучшенная масштабируемость
- Независимость развития функционала корзины от других сервисов
- Независимость работы сервиса от других сервисов.

• Негативные последствия:
- Увеличенная сложность разработки
- Дополнительная сложность в развертывании и поддержке

### Сравнительный анализ

### Выделение корзины в отдельный микросервис

- Плюсы 
  - Высокая масштабируемость
  - Улучшенная отказоустойчивость
  - Возможность работы сервисов независимо друг от друга.
- Минусы
  - Сложность разработки
  - Сложность поддержки.

### Размещение функционала корзины внутри сервиса заказов:

- Плюсы
  - Простота в реализации и интеграции.

- Минусы
  - Возможные проблемы масштабируемости и поддержки при увеличении объема данных.


## ADR #4: Cинхронизация данных между БД микросервисов

### Контекст и постановка задачи
В системе каждый микросервис хранит данные в своей собственной базе данных. Для обеспечения целостности данных и связей между сервисами необходим механизм синхронизации изменений между различными БД микросервисов.

### Драйверы принятия решений
- Обеспечение целостности данных. Необходимо гарантировать согласованность данных между различными сервисами и их БД.
- Уменьшение нагрузки на сеть и обеспечение высокой производительности. Желание избежать частых запросов между сервисами для синхронизации данных.

## Рассматриваемые варианты
- Обмен сообщениями после записи в БД (до или после коммита): После изменения в БД микросервиса генерируются сообщения, которые уведомляют другие сервисы о совершенных изменениях.
- Transactional Outbox: Использование паттерна Transactional Outbox для записи сообщений о событиях изменения данных в отдельную таблицу или хранилище, которые затем будут обработаны для обновления других БД микросервисов.
- Change Data Capture (CDC): Использование CDC для отслеживания и записи изменений данных в журнале транзакций или специальном механизме, который будет реплицировать изменения в другие БД.

### Результат решения
Выбран вариант: "Transactional Outbox". Этот выбор обусловлен потребностью в обеспечении согласованности данных и снижении нагрузки на сеть путем записи сообщений о событиях изменения данных в отдельное хранилище.

• Положительные последствия: 
- Обеспечение целостности данных.
- Cнижение частоты запросов на сети.
- Отделение сервисов от непосредственной синхронизации.

• Негативные последствия:
- Дополнительная сложность в реализации механизма обработки сообщений.
- Возможность задержек при обработке сообщений.


### Сравнительный анализ

### Обмен сообщениями после изменений в БД

- Плюсы
  - Моментальное уведомление о совершенных изменениях
  - минимизация задержек и обеспечение согласованности данных.  

- Минусы
  - Увеличение нагрузки на систему из-за необходимости генерации и обработки сообщений
  - Возможность потери сообщений при сбоях. В негативном сценарии сообщение может быть не отправлено.


### Change Data Capture (CDC)

- Плюсы
  - Автоматическое отслеживание изменений данных без добавления дополнительной логики в приложениях.  

- Минусы
  - Возможно увеличение нагрузки на БД из-за репликации данных, потенциальная сложность конфигурации и поддержки.

